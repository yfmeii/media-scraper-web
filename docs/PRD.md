# PRD

产品名称: MediaScraper 媒体刮削管理工具

## 1. 背景与目标
- 背景: 本地媒体库需要统一命名与元数据, 传统手工整理成本高.
- 目标: 降低整理成本, 提升刮削准确率, 缩短入库时间.

## 2. 目标用户
- 自建媒体库的个人用户
- 家庭影音服务器维护者

## 3. 核心场景
- 收件箱: 新下载文件自动解析与匹配, 一键入库.
- 剧集库: 可视化浏览, 可重新刮削与更新元数据.
- 电影库: 可视化浏览, 可重新刮削与更新元数据.
- AI 消歧: 候选多时自动选择.

## 4. 需求范围
- P0
  - 首页统计与快速入口
  - 收件箱按目录展示与批量处理
  - TMDB 自定义名称搜索
  - 剧集/电影列表与元数据刷新
  - AI 消歧与手动消歧
  - 新增剧集文件放入已刮削目录后的补充识别与刮削
- P1
  - 表格视图多选一键刮削
  - 进度条集中展示
  - 列表元素完整性展示(海报/NFO 等)
- P2
  - 多语言切换
  - 任务队列与进度

## 5. 功能需求
### 5.1 首页
- 统计: 剧集数/集数/电影数/已处理/收件箱数
- TMDB 快速搜索

### 5.2 收件箱
- 目录视图: 以文件夹为主维度, 展示目录内文件
- 文件名解析: 标题/年份/季集/分辨率/编码标签
- 自动匹配与候选列表
- AI 选择与手动搜索
- 批量处理: 多选后统一执行刮削
- 处理入库: 移动文件, 写入 NFO, 下载海报

### 5.3 剧集库
- 列表展示: 名称/季数/集数/状态/海报/NFO
- 分组展示: 已刮削/未刮削
- 刮削: 搜索 TMDB, AI 选择, 刷新元数据
- 已刮削目录补充识别: 新增剧集文件放入后可补刮
- 针对剧集/季级元数据的刮削

### 5.4 电影库
- 列表展示: 名称/年份/大小/分辨率/状态/海报/NFO
- 刮削: 搜索 TMDB, 刷新元数据

### 5.5 交互与批量策略
- 表格视图为默认主视图, 兼容多选
- 多选支持一键刮削, 并在执行前选择消歧策略: 手动/AI 自动
- 选中条目在列表下方显示统一进度条与任务摘要
- 双击行进入详情, 单击为选中
- 行 hover 展示快捷操作

### 5.6 状态与完整性
- 状态以图标 + 颜色 + 文本同时表达
- 完整性维度: 海报/NFO/可选背景图
- 未完整项需可一键补齐

### 5.7 安全与可控
- 所有移动/覆盖操作必须提供预览与二次确认
- 批量操作需显示影响范围与可回退信息

## 6. 用户故事
- 作为用户, 我希望将新下载的剧集放进收件箱后一键入库.
- 作为用户, 我希望同名或重名时能让 AI 帮我选择.
- 作为用户, 我希望能手动指定名称搜索 TMDB.
- 作为用户, 我希望把新剧集文件放到已刮削目录后能自动补刮.
- 作为用户, 我希望在列表中看见海报/NFO 是否完整.
- 作为用户, 我希望对选中的多条记录一键刮削.

## 7. 成功指标
- 处理成功率 >= 95%
- 平均单文件处理时间 <= 15s
- AI 消歧命中率 >= 80%
- 批量刮削失败率 <= 5%
- 进度可见性: 100% 任务有明确状态

## 8. 约束与假设
- 依赖 TMDB API, Dify 可选.
- 具备文件系统读写权限.
- 默认运行在本机或内网.
- 默认暗色风格, 明亮模式为 P2.

## 9. 风险
- 错误匹配导致移动/覆盖风险.
- 外部 API 不可用导致功能降级.
- 路径传参需严格限制可访问目录.
- 批量刮削与补刮可能造成大量 IO.

## 10. 验收标准(要点)
- 收件箱目录视图可浏览并按目录批量刮削
- 剧集/电影表格支持多选并选择消歧策略
- 列表可见海报/NFO 完整性并可补齐
- 进度条固定在列表下方并展示成功/失败
- 新增剧集文件放入已刮削目录后可被检测并补刮

## 11. 非目标
- 不做多用户权限管理.
- 不做在线播放/转码.
- 不做下载器集成.
