# ğŸ¬ åª’ä½“åˆ®å‰Šç®¡ç†å·¥å…·

å¯è§†åŒ–ç®¡ç†åª’ä½“æ–‡ä»¶ï¼Œæ”¯æŒ TMDB åˆ®å‰Šå’Œ AI æ™ºèƒ½è·¯å¾„è¯†åˆ«çš„ç°ä»£åŒ– Web + å°ç¨‹åºåº”ç”¨ã€‚

## ğŸ“– æ¦‚å¿µè¯´æ˜

| æœ¯è¯­ | å«ä¹‰ | ä½•æ—¶ä½¿ç”¨ |
|------|------|----------|
| **åˆ®å‰Š** | é¦–æ¬¡å¤„ç†åª’ä½“æ–‡ä»¶ï¼šåŒ¹é… TMDB â†’ ç§»åŠ¨æ–‡ä»¶ â†’ åˆ›å»º NFO â†’ ä¸‹è½½æµ·æŠ¥ | æ–°å…¥åº“çš„å‰§é›†/ç”µå½± |
| **åˆ·æ–°å…ƒæ•°æ®** | é‡æ–°è·å–æœ€æ–°ä¿¡æ¯ï¼šæ›´æ–° NFO + ä¸‹è½½æµ·æŠ¥/Fanart | å…ƒæ•°æ®æœ‰è¯¯æˆ– TMDB ä¿¡æ¯æ›´æ–° |
| **é‡æ–°åŒ¹é…** | æ‰‹åŠ¨é€‰æ‹© TMDB æ¡ç›®ï¼ˆå½“è‡ªåŠ¨åŒ¹é…é”™è¯¯æ—¶ï¼‰ | åŒåå‰§é›†/ç”µå½±æ··æ·† |
| **ç§»å›æ”¶ä»¶ç®±** | å°†å·²å…¥åº“æ–‡ä»¶ç§»å›æ”¶ä»¶ç®±ï¼Œåˆ é™¤å…³è”çš„ NFO å…ƒæ•°æ® | å…¥åº“é”™è¯¯éœ€è¦é‡æ–°å¤„ç† |

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ“¥ æ”¶ä»¶ç®±ï¼ˆWeb + å°ç¨‹åºï¼‰
- æŒ‰ç›®å½•åˆ†ç»„æŸ¥çœ‹å¾…å¤„ç†æ–‡ä»¶ï¼ˆWeb æ”¯æŒç›®å½•æ ‘å±•å¼€ï¼‰
- TMDB è‡ªåŠ¨åŒ¹é…å’Œæ‰‹åŠ¨æœç´¢
- **AI æ™ºèƒ½è·¯å¾„è¯†åˆ«**ï¼ˆDifyï¼‰ï¼šè‡ªåŠ¨è¯†åˆ«åª’ä½“ç±»å‹ã€å­£é›†ä¿¡æ¯å¹¶åŒ¹é… TMDB
- å…¥åº“é¢„è§ˆï¼šæ˜¾ç¤ºç›®æ ‡è·¯å¾„ã€NFO åˆ›å»ºè®¡åˆ’ã€è¦†ç›–æç¤º
- ä¸€é”®å…¥åº“ï¼šç§»åŠ¨æ–‡ä»¶ + ç”Ÿæˆ NFO + ä¸‹è½½æµ·æŠ¥/èƒŒæ™¯å›¾
- æ‰¹é‡æ“ä½œï¼šä¸€é”®åŒ¹é…å…¥åº“ã€ä¸€é”® AI è¯†åˆ«å…¥åº“
- æ–‡ä»¶åå…³é”®è¯æœç´¢è¿‡æ»¤
- Web æ”¯æŒ Shift/Ctrl å¤šé€‰ï¼Œå°ç¨‹åºæ”¯æŒå‹¾é€‰æ¡†å¤šé€‰

### ğŸ“º å‰§é›†ç®¡ç†ï¼ˆWeb + å°ç¨‹åºï¼‰
- Webï¼šè¡¨æ ¼è§†å›¾ï¼ˆæµ·æŠ¥ç¼©ç•¥å›¾ã€å‰§åã€å¹´ä»½ã€TMDB IDã€å­£/é›†æ•°ã€çŠ¶æ€æ ‡ç­¾ï¼‰
- å°ç¨‹åºï¼šå®«æ ¼/åˆ—è¡¨åˆ‡æ¢è§†å›¾ï¼Œç¼ºé›†å¾½ç« æ ‡è®°ï¼Œå…³é”®è¯æœç´¢
- å¤šé€‰ + æ‰¹é‡æ“ä½œï¼šåˆ·æ–°å…ƒæ•°æ®ã€é‡æ–°åŒ¹é…
- **è¯¦æƒ…é¢æ¿**ï¼ˆWeb æŠ½å±‰ / å°ç¨‹åºå¼¹æ¡†ï¼‰ï¼š
  - Fanart èƒŒæ™¯å›¾ã€æµ·æŠ¥å°é¢
  - å‰§æƒ…ç®€ä»‹ï¼ˆæ”¯æŒå±•å¼€/æ”¶èµ·ï¼‰
  - å…ƒæ•°æ®æ ‡ç­¾ï¼šè¯„åˆ†ã€å¹´ä»½ã€æ’­å‡ºçŠ¶æ€ã€æ€»å­£é›†æ•°
  - å¯æŠ˜å å­£é›†åˆ—è¡¨ï¼Œæ˜¾ç¤ºæ–‡ä»¶å¤§å°å’Œ NFO çŠ¶æ€
  - **ç²’åº¦åŒ–æ“ä½œ**ï¼šæŒ‰å‰§/æŒ‰å­£/æŒ‰é›† åˆ·æ–°å…ƒæ•°æ®ï¼›æŒ‰é›†ç§»å›æ”¶ä»¶ç®±
  - ç¼ºé›†æ£€æµ‹ä¸å±•ç¤º
  - TMDB é“¾æ¥ã€è·¯å¾„å¤åˆ¶
  - èµ„äº§å®Œæ•´æ€§æ£€æŸ¥ï¼ˆæµ·æŠ¥ã€NFOã€Fanartï¼‰

### ğŸ¬ ç”µå½±ç®¡ç†ï¼ˆWeb + å°ç¨‹åºï¼‰
- Webï¼šè¡¨æ ¼è§†å›¾ï¼ˆæµ·æŠ¥ã€ç‰‡åã€å¹´ä»½ã€TMDB IDã€çŠ¶æ€æ ‡ç­¾ï¼‰
- å°ç¨‹åºï¼šå®«æ ¼/åˆ—è¡¨åˆ‡æ¢è§†å›¾ï¼Œå…³é”®è¯æœç´¢
- å¤šé€‰ + æ‰¹é‡æ“ä½œï¼šåˆ·æ–°å…ƒæ•°æ®ã€é‡æ–°åŒ¹é…
- **è¯¦æƒ…é¢æ¿**ï¼ˆWeb æŠ½å±‰ / å°ç¨‹åºå¼¹æ¡†ï¼‰ï¼š
  - Fanart èƒŒæ™¯å›¾
  - å‰§æƒ…ç®€ä»‹å’Œ Tagline
  - å…ƒæ•°æ®æ ‡ç­¾ï¼šè¯„åˆ†ã€å¹´ä»½ã€æ—¶é•¿
  - æ–‡ä»¶ä¿¡æ¯ï¼šåˆ†è¾¨ç‡ã€ç¼–ç ã€æ¥æºã€å¤§å°
  - ç§»å›æ”¶ä»¶ç®±
  - TMDB é“¾æ¥ã€è·¯å¾„å¤åˆ¶
  - èµ„äº§å®Œæ•´æ€§æ£€æŸ¥

### ğŸ“Š é¦–é¡µæ¦‚è§ˆï¼ˆWeb + å°ç¨‹åºï¼‰
- åª’ä½“åº“ç»Ÿè®¡ï¼šå‰§é›†æ•°ã€æ€»é›†æ•°ã€ç”µå½±æ•°ã€æ”¶ä»¶ç®±å¾…å¤„ç†æ•°
- Webï¼šæœ€è¿‘ä»»åŠ¡åˆ—è¡¨ï¼›å°ç¨‹åºï¼šå¿«æ·å¯¼èˆªå…¥å£

### ğŸ“± å¾®ä¿¡å°ç¨‹åºç‰¹æœ‰
- å°é¢å›¾ HTTP ä»£ç†ï¼ˆç»•è¿‡å°ç¨‹åº HTTPS é™åˆ¶ï¼‰
- æœåŠ¡å™¨è¿æ¥é…ç½®ä¸åœ¨çº¿çŠ¶æ€æ£€æµ‹
- å›¾ç‰‡ä»£ç†åœ°å€è‡ªå®šä¹‰
- ä¸‹æ‹‰åˆ·æ–°

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Docker Composeï¼ˆæ¨èï¼‰

1. åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š
```bash
cp .env.example .env
# ç¼–è¾‘ .env è®¾ç½®åª’ä½“è·¯å¾„å’Œ API å¯†é’¥
```

2. å¯åŠ¨æœåŠ¡ï¼š
```bash
docker compose up -d
```

3. è®¿é—® http://localhost:3000

### æ‰‹åŠ¨è¿è¡Œ

éœ€è¦ [Bun](https://bun.sh) è¿è¡Œæ—¶ï¼ˆv1.0+ï¼‰å’Œ [pnpm](https://pnpm.io)ï¼ˆå°ç¨‹åºå­é¡¹ç›®ï¼‰ã€‚

```bash
# å®‰è£…ä¾èµ–ï¼ˆæ ¹ç›®å½• pnpm workspace ç®¡ç†ï¼‰
bun install

# æ„å»ºå‰ç«¯
bun run build:web

# å¤åˆ¶å‰ç«¯æ„å»ºåˆ° public
cp -r client/web/build/* public/

# å¯åŠ¨æœåŠ¡
bun run server/server.ts
```

## âš™ï¸ é…ç½®

é€šè¿‡ç¯å¢ƒå˜é‡æˆ– `.env` æ–‡ä»¶é…ç½®ï¼š

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `INBOX_PATH` | å¾…å¤„ç†æ–‡ä»¶ç›®å½• | `/mnt/media/Inbox` |
| `TV_PATH` | å‰§é›†ç›®å½• | `/mnt/media/TV` |
| `MOVIES_PATH` | ç”µå½±ç›®å½• | `/mnt/media/Movies` |
| `TMDB_API_KEY` | TMDB API å¯†é’¥ | *å¿…å¡«* |
| `DIFY_PATH_RECOGNIZER_KEY` | Dify è·¯å¾„è¯†åˆ« API å¯†é’¥ | *å¯é€‰* |
| `DIFY_URL` | Dify API åœ°å€ | `https://api.dify.ai/v1/chat-messages` |
| `PORT` | æœåŠ¡ç«¯å£ | `3000` |

### TMDB API Key

1. æ³¨å†Œ [TMDB](https://www.themoviedb.org/) è´¦å·
2. è¿›å…¥ Settings > API > Create > Developer
3. è·å– API Key (v3 auth)

### Dify AI è·¯å¾„è¯†åˆ«ï¼ˆå¯é€‰ï¼‰

> ç© NAS çš„è¯¥ä¸ä¼šæ²¡è£… [Dify](https://github.com/langgenius/dify) å§ï¼ŸğŸ¤”

AI è·¯å¾„è¯†åˆ«åŠŸèƒ½å¯ä»¥æ™ºèƒ½è§£æå¤æ‚çš„æ–‡ä»¶åï¼Œè‡ªåŠ¨è¯†åˆ«åª’ä½“ç±»å‹ã€å­£é›†ä¿¡æ¯ï¼Œå¹¶åŒ¹é… TMDBã€‚

**éœ€è¦å®‰è£…çš„ Dify æ’ä»¶ï¼š**

| æ’ä»¶ | è¯´æ˜ | å®‰è£…æ–¹å¼ |
|------|------|----------|
| [langgenius/openai](https://marketplace.dify.ai/plugins/langgenius/openai) | OpenAI æ¨¡å‹æ¥å…¥ | Dify æ’ä»¶å¸‚åœº |
| [lcandy/tmdb](https://marketplace.dify.ai/plugins/lcandy/tmdb) | TMDB æœç´¢å·¥å…· | Dify æ’ä»¶å¸‚åœº |

**é…ç½®æ­¥éª¤ï¼š**

1. éƒ¨ç½² Dify å®ä¾‹ï¼ˆè‡ªæ‰˜ç®¡æˆ–äº‘æœåŠ¡ï¼‰
2. å®‰è£…ä¸Šè¿°ä¸¤ä¸ªæ’ä»¶
3. å¯¼å…¥å·¥ä½œæµï¼š`dify/path-recognizer.yml`
4. é…ç½® OpenAI API Keyï¼ˆæ”¯æŒä»»ä½• OpenAI å…¼å®¹ APIï¼‰
5. å‘å¸ƒåº”ç”¨å¹¶è·å– API å¯†é’¥
6. é…ç½®ç¯å¢ƒå˜é‡ï¼š
   - `DIFY_PATH_RECOGNIZER_KEY` - åº”ç”¨ API å¯†é’¥
   - `DIFY_URL` - API åœ°å€ï¼Œå¦‚ `https://your-dify.com/v1/chat-messages`

**å·¥ä½œæµåŠŸèƒ½ï¼š**

- è§£ææ–‡ä»¶è·¯å¾„ä¸­çš„æ ‡é¢˜ã€å¹´ä»½ã€å­£é›†ä¿¡æ¯
- è‡ªåŠ¨è¯†åˆ«åª’ä½“ç±»å‹ï¼ˆç”µè§†å‰§/ç”µå½±ï¼‰
- è°ƒç”¨ TMDB å¤šç±»å‹æœç´¢
- AI æ™ºèƒ½é€‰æ‹©æœ€ä½³åŒ¹é…
- è¿”å›åŒ¹é…ç»“æœå’Œç½®ä¿¡åº¦

## ğŸ“ é¡¹ç›®ç»“æ„

```
media-scraper-web/
â”œâ”€â”€ server/                 # åç«¯æºç  (Bun + Hono)
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ config.ts       # é…ç½®
â”‚   â”‚   â”œâ”€â”€ scanner.ts      # æ–‡ä»¶æ‰«æï¼ˆå« NFO è§£æï¼‰
â”‚   â”‚   â”œâ”€â”€ scraper.ts      # åˆ®å‰Šé€»è¾‘ï¼ˆNFO ç”Ÿæˆï¼‰
â”‚   â”‚   â”œâ”€â”€ cleanup.ts      # æºç›®å½•å®‰å…¨æ¸…ç†
â”‚   â”‚   â”œâ”€â”€ tmdb.ts         # TMDB API
â”‚   â”‚   â”œâ”€â”€ dify.ts         # AI è·¯å¾„è¯†åˆ«
â”‚   â”‚   â””â”€â”€ tasks.ts        # ä»»åŠ¡ç®¡ç†
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ media.ts        # åª’ä½“ API
â”‚   â”‚   â”œâ”€â”€ scrape.ts       # åˆ®å‰Š API
â”‚   â”‚   â””â”€â”€ tasks.ts        # ä»»åŠ¡ API
â”‚   â”œâ”€â”€ server.ts           # å…¥å£
â”‚   â””â”€â”€ tsconfig.json       # æœåŠ¡ç«¯ TS é…ç½®
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ web/                # Web ç®¡ç†å° (SvelteKit + Tailwind v4)
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib/
â”‚   â”‚       â”‚   â”œâ”€â”€ api.ts      # API å®¢æˆ·ç«¯
â”‚   â”‚       â”‚   â”œâ”€â”€ format.ts   # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚       â”‚   â”œâ”€â”€ components/ # UI ç»„ä»¶åº“
â”‚   â”‚       â”‚   â””â”€â”€ stores/     # Svelte çŠ¶æ€å­˜å‚¨
â”‚   â”‚       â””â”€â”€ routes/         # é¡µé¢è·¯ç”±
â”‚   â””â”€â”€ weapp/              # å¾®ä¿¡å°ç¨‹åº (weapp-vite + wevu + TDesign)
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ pages/          # é¡µé¢ï¼ˆindex/inbox/library/match/settings/setupï¼‰
â”‚           â”œâ”€â”€ components/     # ç»„ä»¶ï¼ˆMediaDetail/InboxFileDetail/MediaPoster ç­‰ï¼‰
â”‚           â”œâ”€â”€ hooks/          # å¤ç”¨é€»è¾‘ï¼ˆuseMediaMatch/useMediaProcess ç­‰ï¼‰
â”‚           â”œâ”€â”€ stores/         # çŠ¶æ€ï¼ˆserver/tabï¼‰
â”‚           â””â”€â”€ utils/          # API/è¯·æ±‚/é…ç½®/WXS æ ¼å¼åŒ–
â”œâ”€â”€ packages/shared/        # å…±äº«ç±»å‹ã€å¸¸é‡ä¸å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ src/index.ts        # ç±»å‹ + VIDEO_EXTS + formatXxx + getMissingEpisodes ç­‰
â”œâ”€â”€ dify/                   # Dify å·¥ä½œæµé…ç½®
â”‚   â””â”€â”€ path-recognizer.yml # AI è·¯å¾„è¯†åˆ«å·¥ä½œæµ
â”œâ”€â”€ pnpm-workspace.yaml     # Monorepo å·¥ä½œåŒºé…ç½®
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â””â”€â”€ .env.example
```

## ğŸ”Œ API ç«¯ç‚¹

### åª’ä½“
- `GET /api/media/tv` - å‰§é›†åˆ—è¡¨ï¼ˆæ”¯æŒ `?include=assets&group=status`ï¼‰
- `GET /api/media/movies` - ç”µå½±åˆ—è¡¨ï¼ˆæ”¯æŒ `?include=assets`ï¼‰
- `GET /api/media/inbox` - æ”¶ä»¶ç®±æ–‡ä»¶åˆ—è¡¨
- `GET /api/media/inbox?view=dir` - æ”¶ä»¶ç®±æŒ‰ç›®å½•åˆ†ç»„
- `GET /api/media/stats` - åª’ä½“åº“ç»Ÿè®¡
- `GET /api/media/poster?path=` - å›¾ç‰‡ä»£ç†ï¼ˆè¿”å›æœ¬åœ°æµ·æŠ¥/Fanart æ–‡ä»¶ï¼‰

### åˆ®å‰Š
- `GET /api/scrape/search/tv?q=` - æœç´¢å‰§é›†
- `GET /api/scrape/search/movie?q=` - æœç´¢ç”µå½±
- `GET /api/scrape/search/multi?q=` - å¤šç±»å‹æœç´¢
- `GET /api/scrape/search/imdb?imdb_id=` - æŒ‰ IMDB ID æœç´¢
- `POST /api/scrape/match` - è‡ªåŠ¨åŒ¹é…
- `POST /api/scrape/recognize` - AI è·¯å¾„è¯†åˆ«ï¼ˆDifyï¼‰
- `POST /api/scrape/process/tv` - å‰§é›†å…¥åº“
- `POST /api/scrape/process/movie` - ç”µå½±å…¥åº“
- `POST /api/scrape/refresh` - åˆ·æ–°å…ƒæ•°æ®ï¼ˆæ”¯æŒæŒ‰å‰§/å­£/é›†ç²’åº¦ï¼‰
- `POST /api/scrape/preview` - é¢„è§ˆç§»åŠ¨è®¡åˆ’
- `POST /api/scrape/move-to-inbox` - ç§»å›æ”¶ä»¶ç®±

### ä»»åŠ¡
- `GET /api/tasks` - ä»»åŠ¡åˆ—è¡¨ï¼ˆæ”¯æŒ `?status=&limit=`ï¼‰
- `GET /api/tasks/stats` - ä»»åŠ¡ç»Ÿè®¡
- `POST /api/tasks/:id/cancel` - å–æ¶ˆä»»åŠ¡

## ğŸ›  å¼€å‘

```bash
# å®‰è£…ä¾èµ–
bun install

# å¼€å‘æ¨¡å¼ï¼ˆå‰åç«¯åŒæ—¶å¯åŠ¨ï¼‰
bun run dev:all

# æˆ–åˆ†åˆ«å¯åŠ¨
bun run dev          # åç«¯ (çƒ­é‡è½½ï¼Œç«¯å£ 3000)
bun run dev:web      # Web å‰ç«¯ (Vite Dev Serverï¼Œç«¯å£ 5173)
bun run dev:weapp    # å¾®ä¿¡å°ç¨‹åº

# è¿è¡Œæµ‹è¯•
bun test

# æ„å»º
bun run build        # åç«¯
bun run build:web    # Web å‰ç«¯
```

### è¿œç¨‹éƒ¨ç½²

```bash
# åŒæ­¥ä»£ç ï¼ˆæ’é™¤ .env é¿å…è¦†ç›–è¿œç¨‹é…ç½®ï¼‰
rsync -avz --delete \
  --exclude 'node_modules' \
  --exclude '.git' \
  --exclude 'client/web/node_modules' \
  --exclude 'client/web/.svelte-kit' \
  --exclude 'client/web/build' \
  --exclude 'client/weapp/dist' \
  --exclude 'client/weapp/node_modules' \
  --exclude 'public' \
  --exclude '.env' \
  ./ user@server:~/media-scraper-web/

# åœ¨è¿œç¨‹æœåŠ¡å™¨æ„å»ºå¹¶å¯åŠ¨
ssh user@server << 'EOF'
cd ~/media-scraper-web
bun install
bun run build:web
cp -r client/web/build/* public/
bun run server/server.ts &
EOF
```

## ğŸ“ License

MIT
