# ğŸ¬ åª’ä½“åˆ®å‰Šç®¡ç†å·¥å…·

å¯è§†åŒ–ç®¡ç†åª’ä½“æ–‡ä»¶ï¼Œæ”¯æŒ TMDB åˆ®å‰Šå’Œ AI æ™ºèƒ½è·¯å¾„è¯†åˆ«çš„ç°ä»£åŒ– Web åº”ç”¨ã€‚

## ğŸ“– æ¦‚å¿µè¯´æ˜

| æœ¯è¯­ | å«ä¹‰ | ä½•æ—¶ä½¿ç”¨ |
|------|------|----------|
| **åˆ®å‰Š** | é¦–æ¬¡å¤„ç†åª’ä½“æ–‡ä»¶ï¼šåŒ¹é… TMDB â†’ ç§»åŠ¨æ–‡ä»¶ â†’ åˆ›å»º NFO â†’ ä¸‹è½½æµ·æŠ¥ | æ–°å…¥åº“çš„å‰§é›†/ç”µå½± |
| **åˆ·æ–°å…ƒæ•°æ®** | é‡æ–°è·å–æœ€æ–°ä¿¡æ¯ï¼šæ›´æ–° NFO + ä¸‹è½½æµ·æŠ¥/Fanart | å…ƒæ•°æ®æœ‰è¯¯æˆ– TMDB ä¿¡æ¯æ›´æ–° |
| **é‡æ–°åŒ¹é…** | æ‰‹åŠ¨é€‰æ‹© TMDB æ¡ç›®ï¼ˆå½“è‡ªåŠ¨åŒ¹é…é”™è¯¯æ—¶ï¼‰ | åŒåå‰§é›†/ç”µå½±æ··æ·† |
| **ç§»å›æ”¶ä»¶ç®±** | å°†å·²å…¥åº“æ–‡ä»¶ç§»å›æ”¶ä»¶ç®±ï¼Œåˆ é™¤å…³è”çš„ NFO å…ƒæ•°æ® | å…¥åº“é”™è¯¯éœ€è¦é‡æ–°å¤„ç† |

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ“¥ æ”¶ä»¶ç®±
- æŒ‰ç›®å½•åˆ†ç»„æŸ¥çœ‹å¾…å¤„ç†æ–‡ä»¶
- è‡ªåŠ¨è§£ææ–‡ä»¶åè·å–æ ‡é¢˜ã€å­£é›†ã€åˆ†è¾¨ç‡ç­‰ä¿¡æ¯
- TMDB è‡ªåŠ¨åŒ¹é…å’Œæ‰‹åŠ¨æœç´¢
- **AI æ™ºèƒ½è·¯å¾„è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«æ–‡ä»¶ç±»å‹ã€å­£é›†ä¿¡æ¯ã€åŒ¹é… TMDB
- é¢„è§ˆç§»åŠ¨è®¡åˆ’ï¼ˆç›®æ ‡è·¯å¾„ã€NFO åˆ›å»ºã€è¦†ç›–æç¤ºï¼‰
- æ‰¹é‡åˆ®å‰Šæ”¯æŒ
- ä¸€é”®å…¥åº“ï¼šç§»åŠ¨æ–‡ä»¶ + ç”Ÿæˆ NFO + ä¸‹è½½æµ·æŠ¥

### ğŸ“º å‰§é›†ç®¡ç†
- è¡¨æ ¼è§†å›¾å±•ç¤ºå‰§é›†åº“
- æµ·æŠ¥ç¼©ç•¥å›¾ã€TMDB IDã€å¤„ç†çŠ¶æ€
- å¤šé€‰æ”¯æŒï¼ˆShift/Ctrl å¿«æ·é”®ï¼‰
- æ‰¹é‡æ“ä½œï¼šåˆ·æ–°å…ƒæ•°æ®ã€é‡æ–°åŒ¹é…ã€ç§»å›æ”¶ä»¶ç®±
- **è¯¦æƒ…æŠ½å±‰**ï¼š
  - Fanart èƒŒæ™¯å›¾å±•ç¤º
  - å‰§æƒ…ç®€ä»‹ï¼ˆæ”¯æŒå±•å¼€/æ”¶èµ·ï¼‰
  - å…ƒæ•°æ®æ ‡ç­¾ï¼šè¯„åˆ†ã€å¹´ä»½ã€æ’­å‡ºçŠ¶æ€ã€å­£/é›†æ•°
  - å¯æŠ˜å å­£é›†æ–‡ä»¶åˆ—è¡¨ï¼Œæ˜¾ç¤ºæ–‡ä»¶å¤§å°
  - TMDB é“¾æ¥è·³è½¬
  - è·¯å¾„ä¸€é”®å¤åˆ¶
  - èµ„äº§å®Œæ•´æ€§æ£€æŸ¥ï¼ˆæµ·æŠ¥ã€NFOã€Fanartï¼‰
- å®æ—¶è¿›åº¦æ¡å’Œè¡¨æ ¼æ›´æ–°

### ğŸ¬ ç”µå½±ç®¡ç†
- ç”µå½±åº“è¡¨æ ¼è§†å›¾
- å¹´ä»½ã€TMDB ID æ˜¾ç¤º
- æ‰¹é‡åˆ·æ–°å…ƒæ•°æ®ã€é‡æ–°åŒ¹é…
- **è¯¦æƒ…æŠ½å±‰**ï¼š
  - Fanart èƒŒæ™¯å›¾å±•ç¤º
  - å‰§æƒ…ç®€ä»‹å’Œ Tagline
  - å…ƒæ•°æ®æ ‡ç­¾ï¼šè¯„åˆ†ã€å¹´ä»½ã€æ—¶é•¿ã€åˆ†è¾¨ç‡ã€ç¼–ç 
  - æ–‡ä»¶æŠ€æœ¯ä¿¡æ¯ï¼šåˆ†è¾¨ç‡ã€ç¼–ç ã€æ¥æºã€å¤§å°
  - TMDB é“¾æ¥è·³è½¬
  - è·¯å¾„ä¸€é”®å¤åˆ¶
  - èµ„äº§å®Œæ•´æ€§æ£€æŸ¥

### ğŸ“Š é¦–é¡µæ¦‚è§ˆ
- åª’ä½“åº“ç»Ÿè®¡ï¼šå‰§é›†æ•°ã€é›†æ•°ã€ç”µå½±æ•°ã€å¾…å¤„ç†æ•°
- æœ€è¿‘ä»»åŠ¡åˆ—è¡¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Docker Composeï¼ˆæ¨èï¼‰

1. åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š
```bash
cp .env.example .env
# ç¼–è¾‘ .env è®¾ç½®åª’ä½“è·¯å¾„å’Œ API å¯†é’¥
```

2. å¯åŠ¨æœåŠ¡ï¼š
```bash
docker compose up -d
```

3. è®¿é—® http://localhost:3000

### æ‰‹åŠ¨è¿è¡Œ

éœ€è¦ [Bun](https://bun.sh) è¿è¡Œæ—¶ï¼ˆv1.0+ï¼‰ã€‚

```bash
# å®‰è£…ä¾èµ–
bun install
cd client/web && bun install && cd ../..

# æ„å»ºå‰ç«¯
cd client/web && bun run build && cd ../..

# å¤åˆ¶å‰ç«¯æ„å»ºåˆ° public
cp -r client/web/build/* public/

# å¯åŠ¨æœåŠ¡
bun run server/server.ts
```

## âš™ï¸ é…ç½®

é€šè¿‡ç¯å¢ƒå˜é‡æˆ– `.env` æ–‡ä»¶é…ç½®ï¼š

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `INBOX_PATH` | å¾…å¤„ç†æ–‡ä»¶ç›®å½• | `/mnt/media/Inbox` |
| `TV_PATH` | å‰§é›†ç›®å½• | `/mnt/media/TV` |
| `MOVIES_PATH` | ç”µå½±ç›®å½• | `/mnt/media/Movies` |
| `TMDB_API_KEY` | TMDB API å¯†é’¥ | *å¿…å¡«* |
| `DIFY_PATH_RECOGNIZER_KEY` | Dify è·¯å¾„è¯†åˆ« API å¯†é’¥ | *å¯é€‰* |
| `DIFY_URL` | Dify API åœ°å€ | `https://api.dify.ai/v1/chat-messages` |
| `PORT` | æœåŠ¡ç«¯å£ | `3000` |

### TMDB API Key

1. æ³¨å†Œ [TMDB](https://www.themoviedb.org/) è´¦å·
2. è¿›å…¥ Settings > API > Create > Developer
3. è·å– API Key (v3 auth)

### Dify AI è·¯å¾„è¯†åˆ«ï¼ˆå¯é€‰ï¼‰

> ç© NAS çš„è¯¥ä¸ä¼šæ²¡è£… [Dify](https://github.com/langgenius/dify) å§ï¼ŸğŸ¤”

AI è·¯å¾„è¯†åˆ«åŠŸèƒ½å¯ä»¥æ™ºèƒ½è§£æå¤æ‚çš„æ–‡ä»¶åï¼Œè‡ªåŠ¨è¯†åˆ«åª’ä½“ç±»å‹ã€å­£é›†ä¿¡æ¯ï¼Œå¹¶åŒ¹é… TMDBã€‚

**éœ€è¦å®‰è£…çš„ Dify æ’ä»¶ï¼š**

| æ’ä»¶ | è¯´æ˜ | å®‰è£…æ–¹å¼ |
|------|------|----------|
| [langgenius/openai](https://marketplace.dify.ai/plugins/langgenius/openai) | OpenAI æ¨¡å‹æ¥å…¥ | Dify æ’ä»¶å¸‚åœº |
| [lcandy/tmdb](https://marketplace.dify.ai/plugins/lcandy/tmdb) | TMDB æœç´¢å·¥å…· | Dify æ’ä»¶å¸‚åœº |

**é…ç½®æ­¥éª¤ï¼š**

1. éƒ¨ç½² Dify å®ä¾‹ï¼ˆè‡ªæ‰˜ç®¡æˆ–äº‘æœåŠ¡ï¼‰
2. å®‰è£…ä¸Šè¿°ä¸¤ä¸ªæ’ä»¶
3. å¯¼å…¥å·¥ä½œæµï¼š`dify/path-recognizer.yml`
4. é…ç½® OpenAI API Keyï¼ˆæ”¯æŒä»»ä½• OpenAI å…¼å®¹ APIï¼‰
5. å‘å¸ƒåº”ç”¨å¹¶è·å– API å¯†é’¥
6. é…ç½®ç¯å¢ƒå˜é‡ï¼š
   - `DIFY_PATH_RECOGNIZER_KEY` - åº”ç”¨ API å¯†é’¥
   - `DIFY_URL` - API åœ°å€ï¼Œå¦‚ `https://your-dify.com/v1/chat-messages`

**å·¥ä½œæµåŠŸèƒ½ï¼š**

- è§£ææ–‡ä»¶è·¯å¾„ä¸­çš„æ ‡é¢˜ã€å¹´ä»½ã€å­£é›†ä¿¡æ¯
- è‡ªåŠ¨è¯†åˆ«åª’ä½“ç±»å‹ï¼ˆç”µè§†å‰§/ç”µå½±ï¼‰
- è°ƒç”¨ TMDB å¤šç±»å‹æœç´¢
- AI æ™ºèƒ½é€‰æ‹©æœ€ä½³åŒ¹é…
- è¿”å›åŒ¹é…ç»“æœå’Œç½®ä¿¡åº¦

## ğŸ“ é¡¹ç›®ç»“æ„

```
media-scraper-web/
â”œâ”€â”€ server/                 # åç«¯æºç  (Bun + Hono)
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ config.ts       # é…ç½®
â”‚   â”‚   â”œâ”€â”€ scanner.ts      # æ–‡ä»¶æ‰«æï¼ˆå« NFO è§£æï¼‰
â”‚   â”‚   â”œâ”€â”€ scraper.ts      # åˆ®å‰Šé€»è¾‘ï¼ˆNFO ç”Ÿæˆï¼‰
â”‚   â”‚   â”œâ”€â”€ tmdb.ts         # TMDB API
â”‚   â”‚   â”œâ”€â”€ dify.ts         # AI è·¯å¾„è¯†åˆ«
â”‚   â”‚   â”œâ”€â”€ tasks.ts        # ä»»åŠ¡ç®¡ç†
â”‚   â”‚   â””â”€â”€ progress.ts     # SSE è¿›åº¦
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ media.ts        # åª’ä½“ API
â”‚   â”‚   â”œâ”€â”€ scrape.ts       # åˆ®å‰Š API
â”‚   â”‚   â””â”€â”€ tasks.ts        # ä»»åŠ¡ API
â”‚   â”œâ”€â”€ server.ts           # å…¥å£
â”‚   â””â”€â”€ tsconfig.json       # æœåŠ¡ç«¯ TS é…ç½®
â”œâ”€â”€ client/web/             # å‰ç«¯æºç  (SvelteKit)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ lib/
â”‚       â”‚   â”œâ”€â”€ api.ts      # API å®¢æˆ·ç«¯
â”‚       â”‚   â”œâ”€â”€ format.ts   # æ ¼å¼åŒ–å·¥å…·
â”‚       â”‚   â”œâ”€â”€ components/ # UI ç»„ä»¶åº“
â”‚       â”‚   â””â”€â”€ stores/     # Svelte çŠ¶æ€å­˜å‚¨
â”‚       â””â”€â”€ routes/         # é¡µé¢è·¯ç”±
â”œâ”€â”€ packages/shared/        # å…±äº«ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ src/index.ts        # ShowInfo, MovieInfo ç­‰ç±»å‹
â”œâ”€â”€ tsconfig.base.json      # åŸºç¡€ TS é…ç½®
â”œâ”€â”€ tsconfig.json           # é¡¹ç›®å¼•ç”¨å…¥å£
â”œâ”€â”€ public/                 # å‰ç«¯æ„å»ºè¾“å‡º
â”œâ”€â”€ dify/                   # Dify å·¥ä½œæµé…ç½®
â”‚   â””â”€â”€ path-recognizer.yml # AI è·¯å¾„è¯†åˆ«å·¥ä½œæµ
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â””â”€â”€ .env.example
```

## ğŸ”Œ API ç«¯ç‚¹

### åª’ä½“
- `GET /api/media/tv` - å‰§é›†åˆ—è¡¨
- `GET /api/media/movies` - ç”µå½±åˆ—è¡¨
- `GET /api/media/inbox` - æ”¶ä»¶ç®±æ–‡ä»¶
- `GET /api/media/inbox?view=dir` - æ”¶ä»¶ç®±æŒ‰ç›®å½•åˆ†ç»„
- `GET /api/media/stats` - åª’ä½“åº“ç»Ÿè®¡

### åˆ®å‰Š
- `GET /api/scrape/search/tv?q=` - æœç´¢å‰§é›†
- `GET /api/scrape/search/movie?q=` - æœç´¢ç”µå½±
- `POST /api/scrape/match` - è‡ªåŠ¨åŒ¹é…
- `POST /api/scrape/recognize` - AI è·¯å¾„è¯†åˆ«
- `POST /api/scrape/process/tv` - å¤„ç†å‰§é›†
- `POST /api/scrape/process/movie` - å¤„ç†ç”µå½±
- `POST /api/scrape/refresh` - åˆ·æ–°å…ƒæ•°æ®
- `POST /api/scrape/preview` - é¢„è§ˆç§»åŠ¨è®¡åˆ’
- `POST /api/scrape/batch` - æ‰¹é‡å¤„ç†
- `POST /api/scrape/move-to-inbox` - ç§»å›æ”¶ä»¶ç®±

### ä»»åŠ¡
- `GET /api/tasks` - ä»»åŠ¡åˆ—è¡¨
- `GET /api/tasks/stats` - ä»»åŠ¡ç»Ÿè®¡
- `GET /api/tasks/active` - æ´»è·ƒä»»åŠ¡
- `POST /api/tasks/:id/cancel` - å–æ¶ˆä»»åŠ¡

### è¿›åº¦
- `GET /api/progress` - SSE å®æ—¶è¿›åº¦

## ğŸ›  å¼€å‘

```bash
# å®‰è£…ä¾èµ–
bun install
cd client/web && bun install && cd ../..

# å¼€å‘æ¨¡å¼ï¼ˆå‰åç«¯åŒæ—¶å¯åŠ¨ï¼‰
bun run dev:all

# æˆ–åˆ†åˆ«å¯åŠ¨
bun run dev          # åç«¯ (çƒ­é‡è½½)
bun run dev:web      # å‰ç«¯

# è¿è¡Œæµ‹è¯•
bun test
bun test --watch

# ç±»å‹æ£€æŸ¥
bunx tsc --build
```

### è¿œç¨‹éƒ¨ç½²

```bash
# åŒæ­¥ä»£ç ï¼ˆæ’é™¤ .env é¿å…è¦†ç›–è¿œç¨‹é…ç½®ï¼‰
rsync -avz --delete \
  --exclude 'node_modules' \
  --exclude '.git' \
  --exclude 'client/web/node_modules' \
  --exclude 'client/web/.svelte-kit' \
  --exclude 'client/web/build' \
  --exclude 'public' \
  --exclude '.env' \
  ./ user@server:~/media-scraper-web/

# åœ¨è¿œç¨‹æœåŠ¡å™¨æ„å»ºå¹¶å¯åŠ¨
ssh user@server << 'EOF'
cd ~/media-scraper-web/client/web
bun run build
cp -r build/* ~/media-scraper-web/public/
cd ~/media-scraper-web
bun run server/server.ts &
EOF
```

## ğŸ“ License

MIT
