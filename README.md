# ğŸ¬ åª’ä½“åˆ®å‰Šç®¡ç†å·¥å…·

å¯è§†åŒ–ç®¡ç†åª’ä½“æ–‡ä»¶ï¼Œæ”¯æŒ TMDB åˆ®å‰Šå’Œ AI æ™ºèƒ½åŒ¹é…çš„ç°ä»£åŒ– Web åº”ç”¨ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ“¥ æ”¶ä»¶ç®±
- æŒ‰ç›®å½•åˆ†ç»„æŸ¥çœ‹å¾…å¤„ç†æ–‡ä»¶
- è‡ªåŠ¨è§£ææ–‡ä»¶åè·å–æ ‡é¢˜ã€å­£é›†ã€åˆ†è¾¨ç‡ç­‰ä¿¡æ¯
- TMDB è‡ªåŠ¨åŒ¹é…å’Œæ‰‹åŠ¨æœç´¢
- é¢„è§ˆç§»åŠ¨è®¡åˆ’ï¼ˆç›®æ ‡è·¯å¾„ã€NFO åˆ›å»ºã€è¦†ç›–æç¤ºï¼‰
- æ‰¹é‡åˆ®å‰Šæ”¯æŒï¼ˆæ‰‹åŠ¨åŒ¹é… / AI è‡ªåŠ¨ï¼‰
- ä¸€é”®å…¥åº“ï¼šç§»åŠ¨æ–‡ä»¶ + ç”Ÿæˆ NFO + ä¸‹è½½æµ·æŠ¥

### ğŸ“º å‰§é›†ç®¡ç†
- è¡¨æ ¼è§†å›¾å±•ç¤ºå‰§é›†åº“
- æµ·æŠ¥ç¼©ç•¥å›¾ã€TMDB IDã€å¤„ç†çŠ¶æ€
- å¤šé€‰æ”¯æŒï¼ˆShift/Ctrl å¿«æ·é”®ï¼‰
- æ‰¹é‡æ“ä½œï¼šåˆ·æ–°å…ƒæ•°æ®ã€è¡¥åˆ®ã€é‡æ–°åŒ¹é…
- è¯¦æƒ…æŠ½å±‰ï¼šå‰§é›†ä¿¡æ¯ã€å­£é›†åˆ—è¡¨ã€èµ„äº§å®Œæ•´æ€§
- å®æ—¶è¿›åº¦æ¡å’Œè¡¨æ ¼æ›´æ–°

### ğŸ¬ ç”µå½±ç®¡ç†
- ç”µå½±åº“è¡¨æ ¼è§†å›¾
- å¹´ä»½ã€TMDB ID æ˜¾ç¤º
- æ‰¹é‡åˆ·æ–°å…ƒæ•°æ®
- è¯¦æƒ…æŠ½å±‰ï¼šç”µå½±ä¿¡æ¯ã€æµ·æŠ¥é¢„è§ˆ

### ğŸ¤– AI æ™ºèƒ½æ¶ˆæ­§
- å½“ TMDB è¿”å›å¤šä¸ªç›¸ä¼¼ç»“æœæ—¶
- AI æ ¹æ®æ–‡ä»¶åã€å¹´ä»½ã€å‘è¡Œæ—¥æœŸç­‰è‡ªåŠ¨é€‰æ‹©æœ€ä½³åŒ¹é…
- æ”¯æŒæ‰¹é‡å¤„ç†æ—¶è‡ªåŠ¨æ¶ˆæ­§

### ğŸ“Š é¦–é¡µæ¦‚è§ˆ
- åª’ä½“åº“ç»Ÿè®¡ï¼šå‰§é›†æ•°ã€é›†æ•°ã€ç”µå½±æ•°ã€å¾…å¤„ç†æ•°
- æœ€è¿‘ä»»åŠ¡åˆ—è¡¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Docker Composeï¼ˆæ¨èï¼‰

1. åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š
```bash
cp .env.example .env
# ç¼–è¾‘ .env è®¾ç½®åª’ä½“è·¯å¾„å’Œ API å¯†é’¥
```

2. å¯åŠ¨æœåŠ¡ï¼š
```bash
docker compose up -d
```

3. è®¿é—® http://localhost:3000

### æ‰‹åŠ¨è¿è¡Œ

éœ€è¦ [Bun](https://bun.sh) è¿è¡Œæ—¶ï¼ˆv1.0+ï¼‰ã€‚

```bash
# å®‰è£…ä¾èµ–
bun install
cd frontend && bun install && cd ..

# æ„å»ºå‰ç«¯
cd frontend && bun run build && cd ..

# å¯åŠ¨æœåŠ¡
bun run src/server.ts
```

## âš™ï¸ é…ç½®

é€šè¿‡ç¯å¢ƒå˜é‡æˆ– `.env` æ–‡ä»¶é…ç½®ï¼š

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `INBOX_PATH` | å¾…å¤„ç†æ–‡ä»¶ç›®å½• | `/mnt/media/Inbox` |
| `TV_PATH` | å‰§é›†ç›®å½• | `/mnt/media/TV` |
| `MOVIES_PATH` | ç”µå½±ç›®å½• | `/mnt/media/Movies` |
| `TMDB_API_KEY` | TMDB API å¯†é’¥ | *å¿…å¡«* |
| `DIFY_API_KEY` | Dify AI API å¯†é’¥ | *å¯é€‰* |
| `DIFY_URL` | Dify API åœ°å€ | `https://api.dify.ai/v1/chat-messages` |
| `PORT` | æœåŠ¡ç«¯å£ | `3000` |

### TMDB API Key

1. æ³¨å†Œ [TMDB](https://www.themoviedb.org/) è´¦å·
2. è¿›å…¥ Settings > API > Create > Developer
3. è·å– API Key (v3 auth)

### Dify AI æ¶ˆæ­§ï¼ˆå¯é€‰ï¼‰

> ç© NAS çš„è¯¥ä¸ä¼šæ²¡è£… [Dify](https://github.com/langgenius/dify) å§ï¼ŸğŸ¤”

å½“ TMDB æœç´¢è¿”å›å¤šä¸ªç›¸ä¼¼ç»“æœæ—¶ï¼ŒAI æ¶ˆæ­§åŠŸèƒ½å¯ä»¥è‡ªåŠ¨é€‰æ‹©æœ€ä½³åŒ¹é…ã€‚

**é…ç½®æ­¥éª¤ï¼š**

1. éƒ¨ç½² Dify å®ä¾‹ï¼ˆè‡ªæ‰˜ç®¡æˆ–äº‘æœåŠ¡ï¼‰
2. å¯¼å…¥å·¥ä½œæµï¼š`dify/media-match-ranker.yml`
3. å‘å¸ƒåº”ç”¨å¹¶è·å– API å¯†é’¥
4. é…ç½®ç¯å¢ƒå˜é‡ï¼š
   - `DIFY_API_KEY` - åº”ç”¨ API å¯†é’¥
   - `DIFY_URL` - API åœ°å€ï¼Œå¦‚ `https://your-dify.com/v1/chat-messages`

**å·¥ä½œæµè¯´æ˜ï¼š**

- æ¥æ”¶åŒ…å« TMDB å€™é€‰çš„åª’ä½“æ–‡ä»¶ä¿¡æ¯
- AI æ ¹æ®æ–‡ä»¶åã€å¹´ä»½ã€å‘è¡Œæ—¥æœŸç­‰è¿›è¡Œæ’åº
- è¿”å›æœ€ä½³åŒ¹é…çš„ TMDB ID å’Œç½®ä¿¡åº¦

## ğŸ“ é¡¹ç›®ç»“æ„

```
media-scraper-web/
â”œâ”€â”€ src/                    # åç«¯æºç  (Bun + Hono)
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ config.ts       # é…ç½®
â”‚   â”‚   â”œâ”€â”€ scanner.ts      # æ–‡ä»¶æ‰«æ
â”‚   â”‚   â”œâ”€â”€ scraper.ts      # åˆ®å‰Šé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ tmdb.ts         # TMDB API
â”‚   â”‚   â”œâ”€â”€ dify.ts         # AI æ¶ˆæ­§
â”‚   â”‚   â”œâ”€â”€ tasks.ts        # ä»»åŠ¡ç®¡ç†
â”‚   â”‚   â””â”€â”€ progress.ts     # SSE è¿›åº¦
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ media.ts        # åª’ä½“ API
â”‚   â”‚   â”œâ”€â”€ scrape.ts       # åˆ®å‰Š API
â”‚   â”‚   â””â”€â”€ tasks.ts        # ä»»åŠ¡ API
â”‚   â””â”€â”€ server.ts           # å…¥å£
â”œâ”€â”€ frontend/               # å‰ç«¯æºç  (SvelteKit)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ lib/api.ts      # API å®¢æˆ·ç«¯
â”‚       â””â”€â”€ routes/         # é¡µé¢
â”œâ”€â”€ docs/                   # è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ PRD.md             # äº§å“éœ€æ±‚
â”‚   â”œâ”€â”€ TAD.md             # æŠ€æœ¯æ¶æ„
â”‚   â””â”€â”€ UI.md              # UI è®¾è®¡
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â””â”€â”€ .env.example
```

## ğŸ”Œ API ç«¯ç‚¹

### åª’ä½“
- `GET /api/media/tv` - å‰§é›†åˆ—è¡¨
- `GET /api/media/movies` - ç”µå½±åˆ—è¡¨
- `GET /api/media/inbox` - æ”¶ä»¶ç®±æ–‡ä»¶
- `GET /api/media/inbox?view=dir` - æ”¶ä»¶ç®±æŒ‰ç›®å½•åˆ†ç»„
- `GET /api/media/stats` - åª’ä½“åº“ç»Ÿè®¡

### åˆ®å‰Š
- `GET /api/scrape/search/tv?q=` - æœç´¢å‰§é›†
- `GET /api/scrape/search/movie?q=` - æœç´¢ç”µå½±
- `POST /api/scrape/match` - è‡ªåŠ¨åŒ¹é…
- `POST /api/scrape/process/tv` - å¤„ç†å‰§é›†
- `POST /api/scrape/process/movie` - å¤„ç†ç”µå½±
- `POST /api/scrape/refresh` - åˆ·æ–°å…ƒæ•°æ®
- `POST /api/scrape/supplement` - è¡¥åˆ®
- `POST /api/scrape/preview` - é¢„è§ˆç§»åŠ¨è®¡åˆ’
- `POST /api/scrape/batch` - æ‰¹é‡å¤„ç†

### ä»»åŠ¡ï¼ˆæœªå®Œæˆï¼‰
- `GET /api/tasks` - ä»»åŠ¡åˆ—è¡¨
- `POST /api/tasks/:id/cancel` - å–æ¶ˆä»»åŠ¡

### è¿›åº¦
- `GET /api/progress` - SSE å®æ—¶è¿›åº¦

## ğŸ›  å¼€å‘

```bash
# å¼€å‘æ¨¡å¼ï¼ˆåç«¯ï¼‰
bun run --watch src/server.ts

# å¼€å‘æ¨¡å¼ï¼ˆå‰ç«¯ï¼‰
cd frontend && bun run dev

# è¿è¡Œæµ‹è¯•
bun test
```

## ğŸ“ License

MIT
